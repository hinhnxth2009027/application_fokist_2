<!DOCTYPE html>
<html lang="en">
<%- include('include/head.ejs') %>
<body class="hold-transition sidebar-mini">
<div class="wrapper">
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
        <!-- Left navbar links -->
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
            </li>
            <li class="nav-item d-none d-sm-inline-block">
                <a href="/admin" class="nav-link">Home</a>
            </li>
        </ul>
    </nav>
    <!-- /.navbar -->
    <!-- Main Sidebar Container -->
    <%- include('include/side_bar.ejs') %>
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1>Create Study</h1>
                    </div>
                </div>
            </div><!-- /.container-fluid -->
        </section>
        <!-- Main content -->
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <!-- left column -->
                    <div class="col-lg-12" style="margin: auto">
                        <!-- general form elements -->
                        <div class="card card-success">
                            <div class="card-header">
                                <h3 class="card-title">New Study</h3>
                            </div>
                            <!-- /.card-header -->
                            <!-- form start -->
                            <form action="/admin/new_study" method="post" name="Create_Event_form"
                                  class="border border-success needs-validation">
                                <div class="card-body">
                                    <div class="col-lg-5">
                                        <div class="form-group">
                                            <label for="Title-event">Title</label>
                                            <input type="text" class="form-control" id="Title-event" name="title"
                                                   placeholder=" Enter Title" required>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 row">
                                        <div class="form-group col-lg-6" style="height: 50px">
                                            <label>Choose avatar</label>
                                            <div class="input-group">
                                                <div class="custom-file">
                                                    <input type="file" id="imageChooser" name="imageChooser" class="custom-file-input">
                                                    <input type="hidden" id="thumbnail" name="thumbnail" required>
                                                    <label class="custom-file-label">Choose File</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group col-lg-6" style="height: 50px">
                                            <label for="teacher">teacher</label>
                                            <select name="teacher" class="form-control mb-sm-5" id="teacher" required>
                                                <% for (var a = 0 ; a < data.length;a++){ %>
                                                <option value="<%= data[a]._id %>"><%= data[a].teacher_name %>(<%= data[a].subject %>)</option>
                                                <% } %>
                                            </select>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="form-group">
                                        <img id="image-preview1" style="width: 150px; display: none"
                                             class="img-bordered" src="" alt="">
                                    </div>
                                    <div class="col-lg-9 col-s-9">
                                        <div class="form-group">
                                            <label for="time">Video intro</label>
                                            <input type="text" id="time" name="video"
                                                   placeholder="Enter iframe youtobe"
                                                   class="form-control" required>
                                        </div>
                                    </div>
                                    <div class="col-lg-8 col-s-8">
                                        <div class="form-group">
                                            <label for="subject">palce</label>
                                            <input type="text" id="subject" name="add_ress" class="form-control"
                                                   placeholder="enter place" required>
                                        </div>
                                    </div>
                                    <div class="col-lg-7 col-s-7">
                                        <div class="form-group">
                                            <label for="time">Study time</label>
                                            <input type="text" id="time" name="time"
                                                   placeholder="study time, for example (19h - 21h)"
                                                   class="form-control" required>
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="form-group">
                                            <label for="content">description</label>
                                            <textarea name="description" class="textarea" placeholder="Place some text here"
                                                      id="content"
                                                      style="width: 100%; height: 200px; font-size: 14px; line-height: 18px; border: 1px solid #dddddd; padding: 10px;" required></textarea>
                                        </div>
                                    </div>
                                     <div class="col-lg-3 col-s-3">
                                         <div class="form-group">
                                             <label for="ages">ages</label>
                                             <select name="ages" id="ages" class="form-control">
                                                 <option value="2" selected>2 years old</option>
                                                 <option value="3">3 years old</option>
                                                 <option value="4">4 years old</option>
                                                 <option value="5">5 years old</option>
                                             </select>
                                         </div>
                                     </div>
                                    <div class="col-lg-5 col-s-5">
                                        <label for="choose_photo">choose photo</label>
                                        <div class="input-group">
                                            <div class="form-control">
                                                <input type="file" id="choose_photo" name="list_photo" class="custom-file-input">
                                                <input type="hidden" name="photo">
                                            </div>
                                            <label class="custom-file-label">choose photo</label>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="col-lg-12 col-s-12" id="image-view" style="height: 0">
                                    </div>
                                    <div class="col-lg-4 col-s-4">
                                        <div class="form-group">
                                            <label for="price" style="display: block">price</label>
                                            <input type="text" name="price" class="form-control" placeholder="price (50.00)">
                                        </div>
                                    </div>
                                </div>
                                <!-- /.card-body -->
                                <div class="card-footer">
                                    <button type="submit" name="btn-submit-event" class="btn btn-success"
                                            style="width: 120px">Create
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div><!-- general form elements -->
                </div>
                <!-- /.row -->
            </div><!-- /.container-fluid -->
        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    <footer class="main-footer">
        <div class="float-right d-none d-sm-block">
            <b>Version</b> 3.1.0-rc
        </div>
        <strong>Copyright &copy; 2014-2020 <a href="https://adminlte.io">AdminLTE.io</a>.</strong> All rights reserved.
    </footer>
    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
        <!-- Control sidebar content goes here -->
    </aside>
    <!-- /.control-sidebar -->
</div>
<!-- jQuery -->
<script>



    var imageURL = document.querySelector('input[name="thumbnail"]')
    const cloudName = 'kee';
    const unsignedUploadPreset = 'qvdcslp4';
    var img = document.querySelector('#imageChooser');
    img.onchange = function () {
        var file1 = this.files[0];
        var url1 = `https://api.cloudinary.com/v1_1/${cloudName}/upload`
        var xhr1 = new XMLHttpRequest();
        xhr1.onreadystatechange = function () {
            if (this.readyState === 4) {
                if (this.status === 200) {
                    var dataJson = JSON.parse(this.responseText)
                    imageURL.value = dataJson.url

                    var img_review = document.getElementById('image-preview1');

                    img_review.src = dataJson.url;

                    img_review.style = 'width:200px';
                }
            }
        }
        xhr1.open('POST', url1, true);
        var ud1 = new FormData();
        ud1.append('upload_preset', unsignedUploadPreset);
        ud1.append('tags', 'browser_upload')
        ud1.append('file', file1)
        xhr1.send(ud1)
    }




    var imageURL2 = document.querySelector('input[name="photo"]')
    const cloudName1 = 'kee';
    const unsignedUploadPreset1 = 'qvdcslp4';
    var img2 = document.querySelector('input[name=list_photo]');
    img2.onchange = function () {


        var file = this.files[0];
        var url = `https://api.cloudinary.com/v1_1/${cloudName1}/upload`
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (this.readyState === 4) {
                if (this.status === 200) {
                    var dataJson = JSON.parse(this.responseText)
                    imageURL2.value += `${dataJson.url},`
                    // var split_img_array = imageURL2.value
                    //
                    // var split_img = split_img_array.split(",");
                    // for (var i = 0 ;i<split_img.length-1;i++){
                    //     console.log( 'day la img thu '+ i +split_img[i])
                    // }
                    var img_review = document.getElementById('image-view');
                        img_review.style.height='152px'
                    img_review.innerHTML += `<div style="height: 150px;overflow: hidden;float: left;border: #00a6ff 2px solid;margin-right: 5px;border-radius: 5px"><img src="${dataJson.url}" height="100%"></div>`
                }
            }
        }
        xhr.open('POST', url, true);
        var ud = new FormData();
        ud.append('upload_preset', unsignedUploadPreset1);
        ud.append('tags', 'browser_upload')
        ud.append('file', file)
        xhr.send(ud)
    }
</script>
<%- include('include/script.ejs') %>
</body>
</html>